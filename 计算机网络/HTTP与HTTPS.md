#### HTTP

HTTP全称为**超文本传输协议 HyperText Transfer Protocol**。
HTTP协议定义了浏览器怎样向万维网服务器请求万维网文档，以及服务器怎样把文档传送给浏览器。从层次的角度看，HTTP是**面向事务**的应用层协议，它是万维网上能够可靠地交换文件的重要基础。

HTTP通信过程大致如下：
![通信过程](http://upload-images.jianshu.io/upload_images/2312315-2c57209d10df6ca1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

每个服务器都有一个服务器进程，不断的监听80端口，来发现是否有浏览器对其发出请求。一旦监听到连接请求就建立TCP连接，浏览器就向服务器发出浏览某个页面的请求，服务器接着就返回所请求的页面作为响应。最后，传输完毕后TCP连接就被释放了。在浏览器和服务器之间的请求和响应的交互，必须按照规定的格式和遵循一定的格式。这些格式和规则就是超文本传输协议HTTP。

HTTP规定在HTTP客户端与HTTP服务器之间的每次交互，都由一个ASCII码串构成的请求和一个类似的通用因特网邮件扩充，即“类MIME(MIME-like)”的响应组成。HTTP报文通常都使用TCP连接传送。

用户浏览页面的方法有两种。
- 在浏览器的地址栏中输入要找到的页面的URL。
- 在页面中通过鼠标点击的方式选中一个可选链接。

HTTP使用了面向连接的TCP作为运输层协议，保证了数据的可靠传输。HTTP不必考虑数据在传输过程中被丢弃后又怎样被重传。但是，HTTP协议**本身是无连接的**。虽然HTTP使用了TCP连接，但通信的双方在交换HTTP报文之前不需要先建立HTTP连接。

HTTP协议是**无状态的**。就是说，同一个客户第二次访问同一个服务器上的页面时，服务器的响应与第一次被访问时的相同，因为服务器并不记得曾经访问过的这个用户（现在通常使用Cookie或Session来恢复用户信息），也不记得为该用户曾经服务过多少次。HTTP的无状态特性简化了服务器的设计，使服务器更容易支持大量并发的HTTP请求。

HTTP/1.0的主要缺点，就是每请求一个文档就要有两倍RTT（RTT为往返时间合）的开销。若主页上有很多连接的对象（如图片等）需要一次进行链接，那么每一次链接下载都要导致2*RTT的开销。另一种开销就是万维网客户和服务器每次建立新的TCP连接都要分配缓存。特别是服务器往往要同时服务大量客户端的请求，所以这种**非持续连接**会使服务器的负担很重。好在浏览器都能提供打开5~10个并行的TCP连接，而每个TCP连接处理客户端的一个请求。因此，使用并行TCP连接可以缩短响应时间。

HTTP/1.1协议较好的解决了这个问题。

#### HTTPS

HTTPS全称为**安全超文本传输协议 Hypertext Transfer Protocol over Secure Socket Layer**，是以安全为目标的HTTP通道，简单来说是HTTP的安全版。即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。

> HTTPS = HTTP + SSL

HTTPS和HTTP的区别主要为以下四点：
一、HTTPS协议需要到ca申请证书，一般免费证书很少，需要交费。
二、HTTP是超文本传输协议，信息是明文传输，https 则是具有安全性的SSL加密传输协议。
三、HTTP和HTTPS使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。
四、HTTP的连接很简单，是无状态的；HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，比HTTP协议安全。

HTTPS握手过程：

1. 客户端产生一个对称的密钥，通过服务器的CA证书进行交换（CA证书实质上是一个公钥，客户端用公钥加密生成的对称秘钥，将加密信息传递，服务器用私钥进行解密获得客户端生成的对称密钥，双方之后通过对称密钥来进行加密传输）。
2. 接下来所有的信息往来就都是加密的。被第三方截获因为没有加密使用的密钥，便无法解密，更无法篡改。

#### SSL
 
SSL全称为**安全套接层Secure Sockets Layer**，其继任者**TLS传输层安全Transport Layer Security**。

##### SSL协议的工作流程
服务器认证阶段：
1. 客户端向服务器发送一个开始信息“Hello”以便开始一个新的会话连接；
2. 服务器根据客户的信息确定是否需要生成新的主密钥，如需要则服务器在响应客户的“Hello”信息时将包含生成主密钥所需的信息；
3. 客户根据收到的服务器响应信息，产生一个主密钥，并用服务器的[公开密钥加密](http://baike.baidu.com/view/444169.htm)后传给服务器；
4. 服务器恢复该主密钥，并返回给客户一个用主密钥认证的信息，以此让客户认证服务器。

##### 用户认证阶段
在此之前，服务器已经通过了客户认证，这一阶段主要完成对客户的认证。经认证的服务器发送一个提问给客户，客户则返回数字签名后的提问和其公钥，从而向服务器提供认证。

##### 握手过程

为了便于更好的认识和理解SSL 协议，这里着重介绍SSL 协议的握手协议。SSL 协议既用到了公钥加密技术又用到了对称加密技术，对称加密技术虽然比公钥加密技术的速度快，可是公钥加密技术提供了更好的身份认证技术。SSL 的握手协议非常有效的让客户和服务器之间完成相互之间的身份认证，其主要过程如下：
①客户端的浏览器向服务器传送客户端SSL 协议的版本号，加密算法的种类，产生的随机数，以及其他服务器和客户端之间通讯所需要的各种信息。
②服务器向客户端传送SSL 协议的版本号，加密算法的种类，随机数以及其他相关信息，同时服务器还将向客户端传送自己的证书。
③客户利用服务器传过来的信息验证服务器的合法性，服务器的合法性包括：证书是否过期，发行服务器证书的CA 是否可靠，发行者证书的公钥能否正确解开服务器证书的“发行者的数字签名”，服务器证书上的域名是否和服务器的实际域名相匹配。如果合法性验证没有通过，通讯将断开；如果合法性验证通过，将继续进行第四步。
④用户端随机产生一个用于后面通讯的“对称密码”，然后用服务器的公钥（服务器的公钥从步骤②中的服务器的证书中获得）对其加密，然后将加密后的“预主密码”传给服务器。
⑤如果服务器要求客户的身份认证（在握手过程中为可选），用户可以建立一个随机数然后对其进行数据签名，将这个含有签名的随机数和客户自己的证书以及加密过的“预主密码”一起传给服务器。
⑥如果服务器要求客户的身份认证，服务器必须检验客户证书和签名随机数的合法性，具体的合法性验证过程包括：客户的证书使用日期是否有效，为客户提供证书的CA 是否可靠，发行CA 的公钥能否正确解开客户证书的发行CA 的数字签名，检查客户的证书是否在证书废止列表（CRL）中。检验如果没有通过，通讯立刻中断；如果验证通过，服务器将用自己的私钥解开加密的“预主密码”，然后执行一系列步骤来产生主通讯密码（客户端也将通过同样的方法产生相同的主通讯密码）。
⑦服务器和客户端用相同的主密码即“通话密码”，一个对称密钥用于SSL 协议的安全数据通讯的加解密通讯。同时在SSL 通讯过程中还要完成数据通讯的完整性，防止数据通讯中的任何变化。
⑧客户端向服务器端发出信息，指明后面的数据通讯将使用的步骤⑦中的主密码为对称密钥，同时通知服务器客户端的握手过程结束。
⑨服务器向客户端发出信息，指明后面的数据通讯将使用的步骤⑦中的主密码为对称密钥，同时通知客户端服务器端的握手过程结束。
⑩SSL 的握手部分结束，SSL 安全通道的数据通讯开始，客户和服务器开始使用相同的对称密钥进行数据通讯，同时进行通讯完整性的检验。